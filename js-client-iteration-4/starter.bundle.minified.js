const env={LOCAL:"local",DEV:"dev",PROD:"prod"},config={lang:"de",languages:["de","en","fr"],environment:env.LOCAL,startMenuEntry:0},ObservableI18n=e=>{const t=new Map;return{discharge:e=>{t.delete(e)},onChangeI18n:(e,n)=>{t.set(""+n,e),t.size>50&&console.debug("log listener count suspicious: ",t.size)},getValue:()=>e,setValue:n=>{if(e===n)return;const a=e;e=n,t.forEach((t=>t(e,a)))}}},Observable=e=>{const t=[];return{onChange:e=>{t.push(e),t.length>50&&console.debug("log listener count suspicious: ",t.length)},getValue:()=>e,setValue:n=>{if(e===n)return;const a=e;e=n,t.forEach((t=>t(e,a)))}}},ObservableList=e=>{const t=[],n=[],a=e=>t=>e.splice(t,1),o=e=>t=>{const n=e.indexOf(t);n>=0&&a(e)(n)},r=o(e),s=a(n);return{onAdd:e=>t.push(e),onDel:e=>n.push(e),add:n=>(e.push(n),t.forEach((e=>e(n))),n),del:e=>{r(e);[...n].forEach(((t,n)=>t(e,(()=>s(n)))))},removeDeleteListener:o(n),count:()=>e.length,countIf:t=>e.reduce(((e,n)=>t(n)?e+1:e),0)}},isFunction=e=>e&&"[object Function]"==={}.toString.call(e),VALUE="value",VALID="valid",LABEL="label",CLICK="click",Attribute=e=>{const t={},n=e=>t.hasOwnProperty(e),a=(e,a=null)=>n(e)?t[e]:t[e]=Observable(a);a(VALUE,e),a(CLICK,!1);let o=e=>e;const r=e=>a(VALUE).setValue(o(e));return Object.freeze({getObs:a,hasObs:n,setValidator:e=>a(VALUE).onChange((t=>a(VALID).setValue(e(t)))),setConverter:e=>{o=e,r(a(VALUE).getValue())},setConvertedValue:r})},valueOf=e=>e.getObs(VALUE).getValue(),setValueOf=e=>t=>e.getObs(VALUE).setValue(t),expressionMaker$1=e=>t=>n=>{isFunction(t)?e.getObs(n).onChange(((e,n)=>t(e,n))):e.getObs(n).onChange((e=>t()))},onValueChange=e=>t=>expressionMaker$1(e)(t)(VALUE),presentationModelFromAttributeNames=e=>{const t=Object.create(null);return e.forEach((e=>{const n=Attribute(void 0);n.getObs(LABEL).setValue(e),t[e]=n})),t},ALL_EVENT_ATTRIBUTE_NAMES=["id","userId","from","to","state"],Event=()=>{const e=presentationModelFromAttributeNames(ALL_EVENT_ATTRIBUTE_NAMES);setValueOf(e.state)("requested");return{count:()=>valueOf(e.from)&&valueOf(e.to)?new Date(valueOf(e.to)).countDaysBetween(new Date(valueOf(e.from))):0,...e}},toEvent=e=>{const t=Event();return e.id&&setValueOf(t.id)(e.id),setValueOf(t.from)(e.from),setValueOf(t.to)(e.to),setValueOf(t.state)(e.state),t},vakansieService=()=>{const e=[{id:0,from:"2021-12-20",to:"2021-12-24",state:"accepted"},{id:1,from:"2022-01-11",to:"2022-01-15",state:"requested"},{id:2,from:"2022-04-12",to:"2022-04-17",state:"requested"}];return{loadeEvents:t=>{t(e.map((e=>toEvent(e))))},createEvent:e=>t=>{setValueOf(e.id)(Math.random()%2),t(e)},removeEvent:e=>{},updateEvent:e=>t=>{t(e)}}},ServiceController=()=>{springServerName,springServerPort,restPath;return{vakansieService:vakansieService()}},doIf=cond=>func=>{cond&&(isFunction(func)?func():eval(func))},I18N_CURRENT_LANG="TRANSLATION_CURRENT_LANGUAGE";let elementIdCounter=0;const i18n=e=>t=>{if(!e)return console.error("No translation key provided ლ(ಠ_ಠლ)"),"no.i18n.key.provided";t.dataset.i18nId=elementIdCounter,translationService.translate(e,(e=>{"button"===t.type?t.value=e:t.innerText=e}),elementIdCounter++)},TranslationService=()=>{let e=!1,t={};const n=ObservableI18n(!1),a=Attribute(localStorage.getItem(I18N_CURRENT_LANG)?localStorage.getItem(I18N_CURRENT_LANG):config.lang),o=()=>{const e=valueOf(a);n.setValue(!1),fetch("src/i18n/"+e+".json").then((e=>e.json())).then((e=>{t=e,n.setValue(!0)}))};onValueChange(a)((t=>{localStorage.setItem(I18N_CURRENT_LANG,t),e&&o()}));const r=(e,n,a)=>doIf(n)(e((e=>{if(!Object.keys(t).length)return e;return t[e]||(console.warn("No translation found ¯\\_(ツ)_/¯ for key: ",e),e)})(a)));return Object.freeze({translate:(e,t,a)=>{n.onChangeI18n((n=>r(t,n,e)),a),r(t,n.getValue(),e)},init:()=>{e=!0,o()},isLangLoaded:n,currentLang:a,dischargeListener:e=>{e.querySelectorAll("[data-i18n-id]").forEach((e=>{const t=e.dataset.i18nId;n.discharge(t)}))}})},translationService=TranslationService(),dom=e=>{let t=document.createDocumentFragment();const n=document.createElement("div");for(n.innerHTML=e.trim();n.childNodes[0];)t.appendChild(n.childNodes[0]);return t.querySelectorAll("[data-i18n]").forEach((e=>{const t=e.dataset.i18n;i18n(t)(e)})),t},child=e=>e.childNodes[0],appendReplacing=e=>t=>{for(;e.hasChildNodes();)e.removeChild(e.firstChild);e.appendChild(t)},eventListItemProjector=(e,t,n,a)=>{const o=dom('\n <div class="card">\n <div class="card-date"><span data-i18n="view.event.from"></span> <input type="date"/></div>\n <div class="card-date"><span data-i18n="view.event.to"></span> <input type="date"></div>\n <div><span data-i18n="view.event.state"></span> <strong></strong></div>\n <div><i class="trash-event fas fa-trash-alt"></i></div>\n </div>\n '),r=child(o),[s,l,i,c]=r.children,d=s.querySelector("input");d.value=valueOf(a.from),d.onchange=()=>setValueOf(a.from)(d.value);const u=l.querySelector("input");u.value=valueOf(a.to),u.onchange=()=>setValueOf(a.to)(u.value);i.querySelector("strong").innerText=valueOf(a.state),c.onclick=t=>e.removeItem(a),r.onmouseover=e=>t.setSelectedModel(a),r.onmouseleave=e=>t.clearSelection(),t.onModelSelected((e=>e===a?c.children[0].classList.add("selected"):c.children[0].classList.remove("selected"))),e.onItemRemove(((e,o)=>{e===a&&(translationService.dischargeListener(r),n.removeChild(r),t.clearSelection(),o())})),n.prepend(o)},eventOverviewProjector=(e,t)=>{const n=dom('\n <div class="card">\n <span><span data-i18n="view.event.year"></span> <strong></strong></span>\n <span><span data-i18n="view.event.availableDays"></span> <strong></strong></span>\n <span><span data-i18n="view.event.events"></span> <strong></strong></span>\n </div>'),a=child(n).querySelectorAll("strong");a[0].innerText=(new Date).getFullYear();const o=()=>{a[1].innerText=valueOf(e.getDaysLeft()),a[2].innerText=e.count()};e.onItemAdd((e=>o())),e.onItemRemove((e=>o())),onValueChange(e.getDaysLeft())((e=>o())),appendReplacing(t)(n),o()},expressionMaker=e=>t=>{isFunction(e)?t(e):t((t=>e()))},ListController=()=>{const e=[],t=ObservableList(e);return{addModel:e=>t.add(e),findById:t=>e.find((e=>valueOf(e.id)===t)),removeModel:t.del,onModelAdd:e=>expressionMaker(e)(t.onAdd),onModelRemove:e=>expressionMaker(e)(t.onDel),size:()=>t.count(),forEach:t=>e.forEach((e=>t(e))),getAll:()=>e,reset:()=>e.splice(0,e.length),pop:()=>e[e.length-1]}},SelectionController=e=>{const t=Observable(e);return{setSelectedModel:t.setValue,getSelectedModel:t.getValue,onModelSelected:e=>expressionMaker(e)(t.onChange),clearSelection:()=>t.setValue(e)}},guardInstanceOfDate=e=>{if(!(e instanceof Date))throw new TypeError("Object is not a valid date",e)},isSameDay=function(e){guardInstanceOfDate(e);const t=this;return t.getFullYear()===e.getFullYear()&&t.getMonth()===e.getMonth()&&t.getDate()===e.getDate()},isBetween=function(e,t){guardInstanceOfDate(e),guardInstanceOfDate(t);return this.getFormatted()>=e.getFormatted()&&this.getFormatted()<=t.getFormatted()},countDaysBetween=function(e){guardInstanceOfDate(e);const t=this,n=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate()),a=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate());return Math.abs((n-a)/864e5)},getFormatted=function(){const e=this;let t=""+e.getFullYear(),n=""+(e.getMonth()+1),a=""+e.getDate();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),[t,n,a].join("-")};Date.prototype.isSameDay=isSameDay,Date.prototype.isBetween=isBetween,Date.prototype.getFormatted=getFormatted,Date.prototype.countDaysBetween=countDaysBetween;const EventController=()=>{const e=Attribute(20),t=Attribute(0),n=Attribute(valueOf(e)),a=ServiceController().vakansieService,o=ListController(),r=e=>{o.addModel(e),onValueChange(e.from)((t=>s(e))),onValueChange(e.to)((t=>s(e))),l()},s=e=>{a.updateEvent(e)((e=>{})),l()},l=()=>{setValueOf(t)(0),o.forEach((e=>setValueOf(t)(valueOf(t)+e.count()))),setValueOf(n)(valueOf(e)-valueOf(t))};return o.onModelRemove((e=>{a.removeEvent(e),l()})),{addItem:o.addModel,removeItem:o.removeModel,onItemAdd:o.onModelAdd,onItemRemove:o.onModelRemove,createItem:()=>{const e=Event();a.createEvent(e)((t=>{setValueOf(e.id)(valueOf(t.id))})),r(e)},count:o.size,getDaysLeft:()=>n,processNewModel:r}},OverView=(e,t,n)=>{eventOverviewProjector(e,n)},EventView=(e,t,n)=>{e.onItemAdd((a=>eventListItemProjector(e,t,n,a)))},start=(e,t)=>{translationService.init();const n=document.getElementById("root"),a=dom(`\n <div id="${e}">\n <NAV class="topnav">\n <DIV class="topnav-header"></DIV>\n <A>Vakansie</A>\n\n <div class="topnav-languages"></div>\n </NAV>\n <DIV id="content">\n <button class="plus-btn">+</button>\n <div class="overview"></div>\n <div class="events"></div>\n </div>\n </div>`),o=child(a),r=EventController(),s=SelectionController("NoItem"),l=o.querySelector("#content"),i=o.querySelector(".topnav-languages"),[c,d,u]=l.children;OverView(r,s,d),EventView(r,s,u),c.onclick=()=>r.createItem();const v=translationService.currentLang;config.languages.forEach((e=>{const t=dom(`<a>${e}</a>`);t.children[0].onclick=()=>setValueOf(v)(e),i.append(t)})),t.forEach((e=>r.processNewModel(e))),n.replaceWith(o)},appRootId=window.appRootId;ServiceController().vakansieService.loadeEvents((e=>start(appRootId,e)));
